---
- name: Network parameter
  hosts: all #change with the group in your inventory that you want to config (change to "all" to config all machine in inventory)
  become: yes
  vars:
    sysctl_parameters:
      - { name: 'net.ipv4.conf.all.send_redirects', value: '0' }
      - { name: 'net.ipv4.conf.default.send_redirects', value: '0' }
      - { name: 'net.ipv4.conf.all.accept_source_route', value: '0' }
      - { name: 'net.ipv4.confdefault.accept_source_route', value: '0' }
      - { name: 'net.ipv6.conf.all.accept_source_route', value: '0' }
      - { name: 'net.ipv6.conf.default.accept_source_route', value: '0' }
      - { name: 'net.ipv4.conf.all.secure_redirects', value: '0' }
      - { name: 'net.ipv4.conf.default.secure_redirects', value: '0' }
      - { name: 'net.ipv4.conf.all.rp_filter', value: '1' }
      - { name: 'net.ipv4.conf.default.rp_filter', value: '1' }
      - { name: 'net.ipv4.ip_forward', value: '0' }
      - { name: 'net.ipv6.conf.all.forwarding', value: '0' }
      - { name: 'net.ipv4.conf.all.log_martians', value: '1' }
      - { name: 'net.ipv4.conf.default.log_martians', value: '1' }
      - { name: 'net.ipv4.tcp_syncookies', value: '1' }
      - { name: 'net.ipv6.conf.all.accept_ra', value: '0' }
      - { name: 'net.ipv6.conf.default.accept_ra', value: '0' }

  tasks:
    - name: directory exist
      ansible.builtin.file:
        path: /etc/sysctl.d
        state: directory
        mode: '0755'

    - name: parameter
      ansible.posix.sysctl:
        name: "{{ item.name }}"
        value: "{{ item.value }}"
        sysctl_file: /etc/sysctl.d/99-cis-hardening.conf
        reload: yes
      loop: "{{ sysctl_parameters }}"
      ignore_errors: yes
